!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Handlebars=t():e.Handlebars=t()}(this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){"use strict";var r=n(1).default,o=n(2).default;t.__esModule=!0;var i=r(n(3)),s=o(n(20)),a=o(n(5)),u=r(n(4)),c=r(n(21)),l=o(n(33));function f(){var e=new i.HandlebarsEnvironment;return u.extend(e,i),e.SafeString=s.default,e.Exception=a.default,e.Utils=u,e.escapeExpression=u.escapeExpression,e.VM=c,e.template=function(t){return c.template(t,e)},e}var d=f();d.create=f,l.default(d),d.default=d,t.default=d,e.exports=t.default},function(e,t){"use strict";t.default=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},t.__esModule=!0},function(e,t){"use strict";t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,n){"use strict";var r=n(2).default;t.__esModule=!0,t.HandlebarsEnvironment=c;var o=n(4),i=r(n(5)),s=n(9),a=n(17),u=r(n(19));t.VERSION="4.0.11";t.COMPILER_REVISION=7;t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};function c(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},s.registerDefaultHelpers(this),a.registerDefaultDecorators(this)}c.prototype={constructor:c,logger:u.default,log:u.default.log,registerHelper:function(e,t){if("[object Object]"===o.toString.call(e)){if(t)throw new i.default("Arg not supported with multiple helpers");o.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if("[object Object]"===o.toString.call(e))o.extend(this.partials,e);else{if(void 0===t)throw new i.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if("[object Object]"===o.toString.call(e)){if(t)throw new i.default("Arg not supported with multiple decorators");o.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]}};var l=u.default.log;t.log=l,t.createFrame=o.createFrame,t.logger=u.default},function(e,t){"use strict";t.__esModule=!0,t.extend=s,t.indexOf=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}if(!o.test(e))return e;return e.replace(r,i)},t.isEmpty=function(e){return!e&&0!==e||!(!c(e)||0!==e.length)},t.createFrame=function(e){var t=s({},e);return t._parent=e,t},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},r=/[&<>"'`=]/g,o=/[&<>"'`=]/;function i(e){return n[e]}function s(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}var a=Object.prototype.toString;t.toString=a;var u=function(e){return"function"==typeof e};u(/x/)&&(t.isFunction=u=function(e){return"function"==typeof e&&"[object Function]"===a.call(e)}),t.isFunction=u;var c=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===a.call(e)};t.isArray=c},function(e,t,n){"use strict";var r=n(6).default;t.__esModule=!0;var o=["description","fileName","lineNumber","message","name","number","stack"];function i(e,t){var n=t&&t.loc,s=void 0,a=void 0;n&&(e+=" - "+(s=n.start.line)+":"+(a=n.start.column));for(var u=Error.prototype.constructor.call(this,e),c=0;c<o.length;c++)this[o[c]]=u[o[c]];Error.captureStackTrace&&Error.captureStackTrace(this,i);try{n&&(this.lineNumber=s,r?Object.defineProperty(this,"column",{value:a,enumerable:!0}):this.column=a)}catch(e){}}i.prototype=new Error,t.default=i,e.exports=t.default},function(e,t,n){e.exports={default:n(7),__esModule:!0}},function(e,t,n){var r=n(8);e.exports=function(e,t,n){return r.setDesc(e,t,n)}},function(e,t){var n=Object;e.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}},function(e,t,n){"use strict";var r=n(2).default;t.__esModule=!0,t.registerDefaultHelpers=function(e){o.default(e),i.default(e),s.default(e),a.default(e),u.default(e),c.default(e),l.default(e)};var o=r(n(10)),i=r(n(11)),s=r(n(12)),a=r(n(13)),u=r(n(14)),c=r(n(15)),l=r(n(16))},function(e,t,n){"use strict";t.__esModule=!0;var r=n(4);t.default=function(e){e.registerHelper("blockHelperMissing",function(t,n){var o=n.inverse,i=n.fn;if(!0===t)return i(this);if(!1===t||null==t)return o(this);if(r.isArray(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):o(this);if(n.data&&n.ids){var s=r.createFrame(n.data);s.contextPath=r.appendContextPath(n.data.contextPath,n.name),n={data:s}}return i(t,n)})},e.exports=t.default},function(e,t,n){"use strict";var r=n(2).default;t.__esModule=!0;var o=n(4),i=r(n(5));t.default=function(e){e.registerHelper("each",function(e,t){if(!t)throw new i.default("Must pass iterator to #each");var n=t.fn,r=t.inverse,s=0,a="",u=void 0,c=void 0;function l(t,r,i){u&&(u.key=t,u.index=r,u.first=0===r,u.last=!!i,c&&(u.contextPath=c+t)),a+=n(e[t],{data:u,blockParams:o.blockParams([e[t],t],[c+t,null])})}if(t.data&&t.ids&&(c=o.appendContextPath(t.data.contextPath,t.ids[0])+"."),o.isFunction(e)&&(e=e.call(this)),t.data&&(u=o.createFrame(t.data)),e&&"object"==typeof e)if(o.isArray(e))for(var f=e.length;s<f;s++)s in e&&l(s,s,s===e.length-1);else{var d=void 0;for(var p in e)e.hasOwnProperty(p)&&(void 0!==d&&l(d,s-1),d=p,s++);void 0!==d&&l(d,s-1,!0)}return 0===s&&(a=r(this)),a})},e.exports=t.default},function(e,t,n){"use strict";var r=n(2).default;t.__esModule=!0;var o=r(n(5));t.default=function(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new o.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var r=n(4);t.default=function(e){e.registerHelper("if",function(e,t){return r.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||r.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})})},e.exports=t.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("log",function(){for(var t=[void 0],n=arguments[arguments.length-1],r=0;r<arguments.length-1;r++)t.push(arguments[r]);var o=1;null!=n.hash.level?o=n.hash.level:n.data&&null!=n.data.level&&(o=n.data.level),t[0]=o,e.log.apply(e,t)})},e.exports=t.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("lookup",function(e,t){return e&&e[t]})},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var r=n(4);t.default=function(e){e.registerHelper("with",function(e,t){r.isFunction(e)&&(e=e.call(this));var n=t.fn;if(r.isEmpty(e))return t.inverse(this);var o=t.data;return t.data&&t.ids&&((o=r.createFrame(t.data)).contextPath=r.appendContextPath(t.data.contextPath,t.ids[0])),n(e,{data:o,blockParams:r.blockParams([e],[o&&o.contextPath])})})},e.exports=t.default},function(e,t,n){"use strict";var r=n(2).default;t.__esModule=!0,t.registerDefaultDecorators=function(e){o.default(e)};var o=r(n(18))},function(e,t,n){"use strict";t.__esModule=!0;var r=n(4);t.default=function(e){e.registerDecorator("inline",function(e,t,n,o){var i=e;return t.partials||(t.partials={},i=function(o,i){var s=n.partials;n.partials=r.extend({},s,t.partials);var a=e(o,i);return n.partials=s,a}),t.partials[o.args[0]]=o.fn,i})},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var r=n(4),o={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=r.indexOf(o.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=o.lookupLevel(e),"undefined"!=typeof console&&o.lookupLevel(o.level)<=e){var t=o.methodMap[e];console[t]||(t="log");for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];console[t].apply(console,r)}}};t.default=o,e.exports=t.default},function(e,t){"use strict";function n(e){this.string=e}t.__esModule=!0,n.prototype.toString=n.prototype.toHTML=function(){return""+this.string},t.default=n,e.exports=t.default},function(e,t,n){"use strict";var r=n(22).default,o=n(1).default,i=n(2).default;t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,n=u.COMPILER_REVISION;if(t!==n){if(t<n){var r=u.REVISION_CHANGES[n],o=u.REVISION_CHANGES[t];throw new a.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+r+") or downgrade your runtime to an older version ("+o+").")}throw new a.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},t.template=function(e,t){if(!t)throw new a.default("No environment passed to template");if(!e||!e.main)throw new a.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var n={strict:function(e,t){if(!(t in e))throw new a.default('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var n=e.length,r=0;r<n;r++)if(e[r]&&null!=e[r][t])return e[r][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:s.escapeExpression,invokePartial:function(n,r,o){o.hash&&(r=s.extend({},r,o.hash),o.ids&&(o.ids[0]=!0));n=t.VM.resolvePartial.call(this,n,r,o);var i=t.VM.invokePartial.call(this,n,r,o);null==i&&t.compile&&(o.partials[o.name]=t.compile(n,e.compilerOptions,t),i=o.partials[o.name](r,o));if(null!=i){if(o.indent){for(var u=i.split("\n"),c=0,l=u.length;c<l&&(u[c]||c+1!==l);c++)u[c]=o.indent+u[c];i=u.join("\n")}return i}throw new a.default("The partial "+o.name+" could not be compiled when running in runtime-only mode")},fn:function(t){var n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,r,o){var i=this.programs[e],s=this.fn(e);return t||o||r||n?i=c(this,e,s,t,n,r,o):i||(i=this.programs[e]=c(this,e,s)),i},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=s.extend({},t,e)),n},nullContext:r({}),noop:t.VM.noop,compilerInfo:e.compiler};function o(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=r.data;o._setup(r),!r.partial&&e.useData&&(i=function(e,t){t&&"root"in t||((t=t?u.createFrame(t):{}).root=e);return t}(t,i));var s=void 0,a=e.useBlockParams?[]:void 0;function c(t){return""+e.main(n,t,n.helpers,n.partials,i,a,s)}return e.useDepths&&(s=r.depths?t!=r.depths[0]?[t].concat(r.depths):r.depths:[t]),(c=f(e.main,c,n,r.depths||[],i,a))(t,r)}return o.isTop=!0,o._setup=function(r){r.partial?(n.helpers=r.helpers,n.partials=r.partials,n.decorators=r.decorators):(n.helpers=n.merge(r.helpers,t.helpers),e.usePartial&&(n.partials=n.merge(r.partials,t.partials)),(e.usePartial||e.useDecorators)&&(n.decorators=n.merge(r.decorators,t.decorators)))},o._child=function(t,r,o,i){if(e.useBlockParams&&!o)throw new a.default("must pass block params");if(e.useDepths&&!i)throw new a.default("must pass parent depths");return c(n,t,e[t],r,0,o,i)},o},t.wrapProgram=c,t.resolvePartial=function(e,t,n){e?e.call||n.name||(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name];return e},t.invokePartial=function(e,t,n){var r=n.data&&n.data["partial-block"];n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var o=void 0;n.fn&&n.fn!==l&&function(){n.data=u.createFrame(n.data);var e=n.fn;o=n.data["partial-block"]=function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return n.data=u.createFrame(n.data),n.data["partial-block"]=r,e(t,n)},e.partials&&(n.partials=s.extend({},n.partials,e.partials))}();void 0===e&&o&&(e=o);if(void 0===e)throw new a.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)},t.noop=l;var s=o(n(4)),a=i(n(5)),u=n(3);function c(e,t,n,r,o,i,s){function a(t){var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=s;return!s||t==s[0]||t===e.nullContext&&null===s[0]||(a=[t].concat(s)),n(e,t,e.helpers,e.partials,o.data||r,i&&[o.blockParams].concat(i),a)}return(a=f(n,a,e,s,r,i)).program=t,a.depth=s?s.length:0,a.blockParams=o||0,a}function l(){return""}function f(e,t,n,r,o,i){if(e.decorator){var a={};t=e.decorator(t,a,n,r&&r[0],o,i,r),s.extend(t,a)}return t}},function(e,t,n){e.exports={default:n(23),__esModule:!0}},function(e,t,n){n(24),e.exports=n(29).Object.seal},function(e,t,n){var r=n(25);n(26)("seal",function(e){return function(t){return e&&r(t)?e(t):t}})},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(27),o=n(29),i=n(32);e.exports=function(e,t){var n=(o.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*i(function(){n(1)}),"Object",s)}},function(e,t,n){var r=n(28),o=n(29),i=n(30),s=function(e,t,n){var a,u,c,l=e&s.F,f=e&s.G,d=e&s.S,p=e&s.P,h=e&s.B,m=e&s.W,v=f?o:o[t]||(o[t]={}),_=f?r:d?r[t]:(r[t]||{}).prototype;for(a in f&&(n=t),n)(u=!l&&_&&a in _)&&a in v||(c=u?_[a]:n[a],v[a]=f&&"function"!=typeof _[a]?n[a]:h&&u?i(c,r):m&&_[a]==c?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t.prototype=e.prototype,t}(c):p&&"function"==typeof c?i(Function.call,c):c,p&&((v.prototype||(v.prototype={}))[a]=c))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,e.exports=s},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(31);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){(function(n){"use strict";t.__esModule=!0,t.default=function(e){var t=void 0!==n?n:window,r=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=r),e}},e.exports=t.default}).call(t,function(){return this}())}])});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?exports.nes=t():e.nes=t()}("undefined"==typeof window?global:window,function(){var e=function(){},t=function(e,t){return"string"==typeof e&&(e=new Error(e)),e.type=t,e},n={1000:"Normal closure",1001:"Going away",1002:"Protocol error",1003:"Unsupported data",1004:"Reserved",1005:"No status received",1006:"Abnormal closure",1007:"Invalid frame payload data",1008:"Policy violation",1009:"Message too big",1010:"Mandatory extension",1011:"Internal server error",1015:"TLS handshake"},r=function(t,n){n=n||{},this._url=t,this._settings=n,this._heartbeatTimeout=!1,this._ws=null,this._reconnection=null,this._reconnectionTimer=null,this._ids=0,this._requests={},this._subscriptions={},this._heartbeat=null,this._packets=[],this._disconnectListeners=null,this._disconnectRequested=!1,this.onError=function(e){return console.error(e)},this.onConnect=e,this.onDisconnect=e,this.onUpdate=e,this.id=null};return r.WebSocket="undefined"==typeof WebSocket?null:WebSocket,r.prototype.connect=function(e){var n=this;return e=e||{},this._reconnection?Promise.reject(new t("Cannot connect while client attempts to reconnect","user")):this._ws?Promise.reject(new t("Already connected","user")):(this._reconnection=!1===e.reconnect?null:{wait:0,delay:e.delay||1e3,maxDelay:e.maxDelay||5e3,retries:e.retries||1/0,settings:{auth:e.auth,timeout:e.timeout}},new Promise(function(t,r){n._connect(e,!0,function(e){return e?r(e):t()})}))},r.prototype._connect=function(e,o,i){var s=this,a=new r.WebSocket(this._url,this._settings.ws);this._ws=a,clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null;var u=function(e){if(i){var t=i;return i=null,t(e)}return s.onError(e)},c=e.timeout?setTimeout(function(){if(s._cleanup(),u(new t("Connection timed out","timeout")),o)return s._reconnect()},e.timeout):null;a.onopen=function(){clearTimeout(c),a.onopen=null,s._hello(e.auth).then(function(){s.onConnect(),u()}).catch(function(e){e.path&&delete s._subscriptions[e.path],s._disconnect(function(){return function(e){return function(t){setTimeout(function(){return e(t)},0)}}(u)(e)},!0)})},a.onerror=function(e){if(a.onopen||!e.errno){clearTimeout(c),s._cleanup();var n=new t("Socket error","ws");return u(n)}},a.onclose=function(e){a.onopen&&u(new t("Connection terminated while waiting to connect","ws"));var r=s._disconnectRequested;s._cleanup();var o={code:e.code,explanation:n[e.code]||"Unknown",reason:e.reason,wasClean:e.wasClean,willReconnect:!!(s._reconnection&&1<=s._reconnection.retries),wasRequested:r};s.onDisconnect(o.willReconnect,o),s._reconnect()},a.onmessage=function(e){return s._onMessage(e)}},r.prototype.overrideReconnectionAuth=function(e){return!!this._reconnection&&(this._reconnection.settings.auth=e,!0)},r.prototype.disconnect=function(){var e=this;return new Promise(function(t){return e._disconnect(t,!1)})},r.prototype._disconnect=function(e,t){this._reconnection=null,clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null;var n=this._disconnectRequested||!t;return this._disconnectListeners?(this._disconnectRequested=n,void this._disconnectListeners.push(e)):!this._ws||this._ws.readyState!==r.WebSocket.OPEN&&this._ws.readyState!==r.WebSocket.CONNECTING?e():(this._disconnectRequested=n,this._disconnectListeners=[e],void this._ws.close())},r.prototype._cleanup=function(){if(this._ws){var n=this._ws;this._ws=null,(n.readyState===r.WebSocket.OPEN||n.readyState===r.WebSocket.CONNECTING)&&n.close(),n.onopen=null,n.onclose=null,n.onerror=e,n.onmessage=null}this._packets=[],this.id=null,clearTimeout(this._heartbeat),this._heartbeat=null;var o=new t("Request failed - server disconnected","disconnect"),i=this._requests;this._requests={};for(var s=Object.keys(i),a=0;a<s.length;++a){var u=i[s[a]];clearTimeout(u.timeout),u.reject(o)}if(this._disconnectListeners){var c=this._disconnectListeners;this._disconnectListeners=null,this._disconnectRequested=!1,c.forEach(function(e){return e()})}},r.prototype._reconnect=function(){var t=this,n=this._reconnection;if(n){if(1>n.retries)return this._disconnect(e,!0);--n.retries,n.wait+=n.delay;var r=Math.min(n.wait,n.maxDelay);this._reconnectionTimer=setTimeout(function(){t._connect(n.settings,!1,function(e){if(e)return t.onError(e),t._reconnect()})},r)}},r.prototype.request=function(e){"string"==typeof e&&(e={method:"GET",path:e});var t={type:"request",method:e.method||"GET",path:e.path,headers:e.headers,payload:e.payload};return this._send(t,!0)},r.prototype.message=function(e){return this._send({type:"message",message:e},!0)},r.prototype._send=function(e,n){if(!this._ws||this._ws.readyState!==r.WebSocket.OPEN)return Promise.reject(new t("Failed to send message - server disconnected","disconnect"));e.id=++this._ids;try{var o=function(e){try{return JSON.stringify(e)}catch(e){throw new t(e,"user")}}(e)}catch(e){return Promise.reject(e)}if(!n)try{return this._ws.send(o),Promise.resolve()}catch(e){return Promise.reject(new t(e,"ws"))}var i={resolve:null,reject:null,timeout:null},s=new Promise(function(e,t){i.resolve=e,i.reject=t});this._settings.timeout&&(i.timeout=setTimeout(function(){return i.timeout=null,i.reject(new t("Request timed out","timeout"))},this._settings.timeout)),this._requests[e.id]=i;try{this._ws.send(o)}catch(n){return clearTimeout(this._requests[e.id].timeout),delete this._requests[e.id],Promise.reject(new t(n,"ws"))}return s},r.prototype._hello=function(e){var t={type:"hello",version:"2"};e&&(t.auth=e);var n=this.subscriptions();return n.length&&(t.subs=n),this._send(t,!0)},r.prototype.subscriptions=function(){return Object.keys(this._subscriptions)},r.prototype.subscribe=function(e,n){var o=this;if(!e||"/"!==e[0])return Promise.reject(new t("Invalid path","user"));var i=this._subscriptions[e];if(i)return-1===i.indexOf(n)&&i.push(n),Promise.resolve();if(this._subscriptions[e]=[n],!this._ws||this._ws.readyState!==r.WebSocket.OPEN)return Promise.resolve();var s=this._send({type:"sub",path:e},!0);return s.catch(function(){delete o._subscriptions[e]}),s},r.prototype.unsubscribe=function(n,o){if(!n||"/"!==n[0])return Promise.reject(new t("Invalid path","user"));var i=this._subscriptions[n];if(!i)return Promise.resolve();var s=!1;if(o){var a=i.indexOf(o);if(-1===a)return Promise.resolve();i.splice(a,1),i.length||(delete this._subscriptions[n],s=!0)}else delete this._subscriptions[n],s=!0;if(!s||!this._ws||this._ws.readyState!==r.WebSocket.OPEN)return Promise.resolve();var u=this._send({type:"unsub",path:n},!0);return u.catch(e),u},r.prototype._onMessage=function(n){this._beat();var r=n.data,o=r[0];if("{"!==o){if(this._packets.push(r.slice(1)),"!"!==o)return;r=this._packets.join(""),this._packets=[]}this._packets.length&&(this._packets=[],this.onError(new t("Received an incomplete message","protocol")));try{var i=function(e){try{return JSON.parse(e)}catch(e){throw new t(e,"protocol")}}(r)}catch(e){return this.onError(e)}var s=null;if(i.statusCode&&400<=i.statusCode&&599>=i.statusCode&&((s=new t(i.payload.message||i.payload.error||"Error","server")).statusCode=i.statusCode,s.data=i.payload,s.headers=i.headers,s.path=i.path),"ping"===i.type)return this._send({type:"ping"},!1).catch(e);if("update"===i.type)return this.onUpdate(i.message);if("pub"!==i.type&&"revoke"!==i.type){var a=this._requests[i.id];if(!a)return this.onError(new t("Received response for unknown request","protocol"));clearTimeout(a.timeout),delete this._requests[i.id];var u=function(e,t){return e?a.reject(e):a.resolve(t)};return"request"===i.type?u(s,{payload:i.payload,statusCode:i.statusCode,headers:i.headers}):"message"===i.type?u(s,{payload:i.message}):"hello"===i.type?(this.id=i.socket,i.heartbeat&&(this._heartbeatTimeout=i.heartbeat.interval+i.heartbeat.timeout,this._beat()),u(s)):"sub"===i.type||"unsub"===i.type?u(s):(u(new t("Received invalid response","protocol")),this.onError(new t("Received unknown response type: "+i.type,"protocol")))}var c=this._subscriptions[i.path];if("revoke"===i.type&&delete this._subscriptions[i.path],c&&void 0!==i.message){var l={};"revoke"===i.type&&(l.revoked=!0);for(var f=0;f<c.length;++f)c[f](i.message,l)}},r.prototype._beat=function(){var e=this;this._heartbeatTimeout&&(clearTimeout(this._heartbeat),this._heartbeat=setTimeout(function(){e.onError(new t("Disconnecting due to heartbeat timeout","timeout")),e._ws.close()},this._heartbeatTimeout))},{Client:r}}),function(){document.addEventListener("submit",function(e){const t=e.target.getAttribute("action");t&&(event.preventDefault(),function(e,t){const n=new XMLHttpRequest,r=new FormData(e);n.addEventListener("load",function(t){e.querySelector(".js-bucket-name").value=""}),n.addEventListener("error",function(e){console.log(e)}),n.open("POST",t),n.send(r)}(e.target,t))})}(),function(){const e=new window.nes.Client("ws://localhost:8000");(async()=>{await e.connect();const t=(e,t)=>{const n=document.querySelector(".js-bucket-list");if(n){const t=document.createElement("div");t.innerHTML=Handlebars.partials.bucket(e),t.firstChild,n.appendChild(Handlebars.partials.bucket(e))}},n=(e,t)=>{console.log(e)},r=window.location.href,o=r.match(/game\/[a-f\d]{24}$/i),i=o&&o[0].match(/[a-f\d]{24}$/i)[0],s=r.match(/bucket\/[a-f\d]{24}$/i),a=s&&s[0].match(/[a-f\d]{24}$/i)[0];i&&(console.log(`/game/${i}`),e.subscribe(`/game/${i}`,t)),i&&a&&(console.log(`/game/${i}/${a}`),e.subscribe(`/game/${i}/${a}`,n))})()}();
//# sourceMappingURL=sourcemaps/scripts.min.js.map
